<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", Arial, sans-serif;
        }
        
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .result-item {
            border-left: 4px solid transparent;
            transition: all 0.2s ease;
        }
        
        .result-item:hover {
            background-color: #f8fafc;
        }
        
        .result-item.success {
            border-left-color: #10b981;
            background-color: #f0fdf4;
        }
        
        .result-item.warning {
            border-left-color: #f59e0b;
            background-color: #fffbeb;
        }
        
        .result-item.error {
            border-left-color: #ef4444;
            background-color: #fef2f2;
        }
        
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .collapsible-content.active {
            max-height: 2000px;
        }
        
        .spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .status-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
            flex-shrink: 0;
        }

        .status-success { background: #10b981; color: white; }
        .status-warning { background: #f59e0b; color: white; }
        .status-error { background: #ef4444; color: white; }

        .scrollable-section {
            max-height: 350px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen text-gray-800">
    <a href="main.html" class="inline-flex items-center text-blue-600 hover:underline font-medium mt-4 ml-4">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
        –ù–∞ –≥–ª–∞–≤–Ω—É—é
    </a>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div id="mainApp">
        <div class="container mx-auto max-w-4xl px-4 py-6">
            
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <header class="text-center mb-6">
                <h1 class="text-2xl font-bold text-gray-900 mb-2">
                    üõ°Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                </h1>
                <p class="text-gray-600 text-sm">
                    –ê–Ω–∞–ª–∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –§–ó-152 —Å —É—á–µ—Ç–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π 2025 –≥–æ–¥–∞
                </p>
            </header>

            <!-- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ -->
            <div class="bg-white rounded-lg shadow-md border border-gray-200 mb-6">
                <div class="p-6">
                    
                    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
                    <div id="successAlert" class="hidden mb-4 p-3 bg-green-50 border border-green-200 rounded-lg">
                        <p class="text-green-800 text-sm font-medium"></p>
                    </div>
                    <div id="errorAlert" class="hidden mb-4 p-3 bg-red-50 border border-red-200 rounded-lg">
                        <p class="text-red-800 text-sm font-medium"></p>
                    </div>

                    <!-- –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ -->
                    <div class="mb-4 flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-6">
                        <label class="inline-flex items-center cursor-pointer">
                            <input type="radio" class="form-radio h-4 w-4 text-blue-600" name="inputMethod" value="url" checked>
                            <span class="ml-2 text-gray-700 font-medium">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ</span>
                        </label>
                        <label class="inline-flex items-center cursor-pointer">
                            <input type="radio" class="form-radio h-4 w-4 text-blue-600" name="inputMethod" value="text">
                            <span class="ml-2 text-gray-700 font-medium">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—Å—Ç–∞</span>
                        </label>
                    </div>

                    <!-- –ü–æ–ª–µ URL -->
                    <div id="urlInputContainer" class="mb-4">
                        <label class="block text-gray-700 font-semibold mb-2 text-sm">–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏:</label>
                        <input type="url" id="policyUrl" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="https://example.com/privacy">
                    </div>

                    <!-- –ü–æ–ª–µ —Ç–µ–∫—Å—Ç–∞ -->
                    <div id="textInputContainer" class="mb-4 hidden">
                        <label class="block text-gray-700 font-semibold mb-2 text-sm">–¢–µ–∫—Å—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏:</label>
                        <textarea id="policyText" rows="6"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                  placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ–ª–∏—Ç–∏–∫–∏..."></textarea>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∏ -->
                    <div class="flex flex-col sm:flex-row gap-3">
                        <button id="analyzeBtn" onclick="analyzePolicy()"
                                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                            üîç –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫—É
                        </button>
                        <button onclick="clearResults()"
                                class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg transition-colors">
                            –û—á–∏—Å—Ç–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>

            <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
            <div id="loading" class="hidden text-center py-6">
                <div class="inline-block h-8 w-8 border-4 border-blue-500 border-t-transparent rounded-full spinner"></div>
                <p class="text-gray-600 mt-2">–ê–Ω–∞–ª–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –§–ó-152...</p>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
            <div id="results" class="hidden space-y-4">
                
                <!-- –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ -->
                <div class="bg-white rounded-lg shadow-md border border-gray-200 p-4">
                    <div class="flex items-center justify-between flex-col sm:flex-row gap-4">
                        <div class="flex items-center gap-3">
                            <div id="scoreCircle" class="w-16 h-16 rounded-full flex items-center justify-center text-white font-bold">
                                <span id="scoreValue">0%</span>
                            </div>
                            <div>
                                <h3 id="scoreTitle" class="font-semibold text-gray-900">–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞</h3>
                                <p id="scoreDesc" class="text-gray-600 text-sm">–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</p>
                            </div>
                        </div>
                        <div id="riskIndicator" class="px-3 py-1 rounded-lg font-semibold text-sm">
                            –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫
                        </div>
                    </div>
                </div>

                <!-- –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
                <div class="bg-white rounded-lg shadow-md border border-gray-200">
                    <button onclick="toggleSection('detailedResults')" 
                            class="w-full p-4 text-left flex items-center justify-between font-semibold text-gray-900 hover:bg-gray-50">
                        <span>üìã –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏</span>
                        <span id="detailedResultsIcon" class="text-gray-500">‚ñº</span>
                    </button>
                    <div id="detailedResultsContent" class="collapsible-content">
                        <div class="p-4 border-t border-gray-200">
                            <div id="checksContainer" class="space-y-2 scrollable-section"></div>
                        </div>
                    </div>
                </div>

                <!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
                <div class="bg-white rounded-lg shadow-md border border-gray-200">
                    <button onclick="toggleSection('recommendations')" 
                            class="w-full p-4 text-left flex items-center justify-between font-semibold text-gray-900 hover:bg-gray-50">
                        <span>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</span>
                        <span id="recommendationsIcon" class="text-gray-500">‚ñº</span>
                    </button>
                    <div id="recommendationsContent" class="collapsible-content">
                        <div class="p-4 border-t border-gray-200">
                            <div id="recList" class="space-y-3 scrollable-section"></div>
                        </div>
                    </div>
                </div>

                <!-- –ü—Ä–∞–≤–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="bg-white rounded-lg shadow-md border border-gray-200">
                    <button onclick="toggleSection('legalInfo')" 
                            class="w-full p-4 text-left flex items-center justify-between font-semibold text-gray-900 hover:bg-gray-50">
                        <span>‚öñÔ∏è –ü—Ä–∞–≤–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ —à—Ç—Ä–∞—Ñ—ã</span>
                        <span id="legalInfoIcon" class="text-gray-500">‚ñº</span>
                    </button>
                    <div id="legalInfoContent" class="collapsible-content">
                        <div class="p-4 border-t border-gray-200">
                            <h4 class="font-semibold text-gray-900 mb-3">–í–æ–∑–º–æ–∂–Ω—ã–µ —à—Ç—Ä–∞—Ñ—ã –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏—è 152-–§–ó (2025):</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div class="p-3 bg-red-50 rounded-lg border border-red-200">
                                    <h5 class="font-semibold text-red-800 mb-2">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è:</h5>
                                    <ul class="text-sm text-red-700 space-y-1">
                                        <li>‚Ä¢ –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö: –¥–æ 18 –º–ª–Ω —Ä—É–±.</li>
                                        <li>‚Ä¢ –ë–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ: –¥–æ 20 –º–ª–Ω —Ä—É–±.</li>
                                        <li>‚Ä¢ –ú–∞—Å—Å–æ–≤–∞—è —É—Ç–µ—á–∫–∞: –¥–æ 15 –º–ª–Ω —Ä—É–±.</li>
                                    </ul>
                                </div>
                                <div class="p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                                    <h5 class="font-semibold text-yellow-800 mb-2">–û–±—ã—á–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è:</h5>
                                    <ul class="text-sm text-yellow-700 space-y-1">
                                        <li>‚Ä¢ –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: –¥–æ 500 —Ç—ã—Å. —Ä—É–±.</li>
                                        <li>‚Ä¢ –ù–µ—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä–∞: –¥–æ 300 —Ç—ã—Å. —Ä—É–±.</li>
                                        <li>‚Ä¢ –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ —Å–æ–≥–ª–∞—Å–∏—è: –¥–æ 500 —Ç—ã—Å. —Ä—É–±.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ -->
                <div class="bg-white rounded-lg shadow-md border border-gray-200 p-4">
                    <h3 class="font-semibold text-gray-900 mb-3">üìÑ –°–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç</h3>
                    <div class="flex flex-col sm:flex-row gap-3">
                        <button onclick="downloadReport('txt')" 
                                class="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                            üìÑ –°–∫–∞—á–∞—Ç—å TXT
                        </button>
                        <button onclick="downloadReport('html')" 
                                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                            üìÑ –°–∫–∞—á–∞—Ç—å –¥–ª—è Word (HTML)
                        </button>
                    </div>
                    <p class="text-sm text-gray-600 mt-2">
                        –û—Ç—á–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Ö —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é
                    </p>
                </div>
            </div>

            <!-- –ë–ª–æ–∫ –æ –ø—Ä–æ–µ–∫—Ç–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ -->
            <div class="bg-gradient-to-r from-blue-100 to-purple-100 rounded-xl shadow-md border border-blue-200 mb-8 p-6 flex flex-col sm:flex-row items-center justify-between gap-6">
                <div class="flex-1">
                    <h2 class="text-xl font-bold text-blue-900 mb-2">üîî –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞</h2>
                    <p class="text-gray-700 mb-3">–°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ –∑–∞–∫–æ–Ω–∞—Ö –æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –§–ó-152. –ü–æ–ª—É—á–∞–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤–∞–∂–Ω—ã—Ö –Ω–æ–≤–æ–≤–≤–µ–¥–µ–Ω–∏—è—Ö –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö!</p>
                    <a href="monitor.html" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-5 rounded-lg transition-colors shadow">–ü–µ—Ä–µ–π—Ç–∏ –∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É</a>
                </div>
                <div class="flex-shrink-0">
                    <svg width="80" height="80" fill="none" viewBox="0 0 80 80"><circle cx="40" cy="40" r="38" fill="#6366F1" fill-opacity="0.1"/><path d="M40 22a18 18 0 0 1 18 18v7.5l2.7 5.4A2 2 0 0 1 58.9 56H21.1a2 2 0 0 1-1.8-3.1l2.7-5.4V40A18 18 0 0 1 40 22Zm0 32a6 6 0 0 0 6-6H34a6 6 0 0 0 6 6Z" fill="#6366F1"/></svg>
                </div>
            </div>
        </div>
    </div>

    <script>
    // Compliance checks for Russian Federal Law 152-FZ (2025)
    const COMPLIANCE_CHECKS = [
        {
            id: 'general_provisions',
            title: '–û–±—â–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è',
            description: '–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö',
            keywords: ['–æ–±—â–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è', '–ø—Ä–∏–Ω—Ü–∏–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏', '—Ü–µ–ª—å –ø–æ–ª–∏—Ç–∏–∫–∏', '152-—Ñ–∑', '—Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –∑–∞–∫–æ–Ω'],
            required: true,
            priority: 'medium',
            lawRef: '–°—Ç. 18.1 152-–§–ó',
            penalty: '–¥–æ 300 000 —Ä—É–±. (—Å—Ç. 13.11 –ö–æ–ê–ü –†–§)',
            recommendation: '–î–æ–±–∞–≤—å—Ç–µ —Ä–∞–∑–¥–µ–ª —Å –ø—Ä–∏–Ω—Ü–∏–ø–∞–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.'
        },
        {
            id: 'operator_details',
            title: '–°–≤–µ–¥–µ–Ω–∏—è –æ–± –æ–ø–µ—Ä–∞—Ç–æ—Ä–µ',
            description: '–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, –û–ì–†–ù, –ò–ù–ù, —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞',
            keywords: ['–æ–≥—Ä–Ω', '–∏–Ω–Ω', '–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', '—é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å', '–æ–ø–µ—Ä–∞—Ç–æ—Ä', '–æ–æ–æ', '–∞–æ', '–∏–ø', '–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'],
            required: true,
            priority: 'critical',
            lawRef: '–ø.1 —á.1 —Å—Ç.18.1 152-–§–ó',
            penalty: '–¥–æ 300 000 —Ä—É–±. (—Å—Ç. 13.11 –ö–æ–ê–ü –†–§)',
            recommendation: '–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, –û–ì–†–ù, –ò–ù–ù –∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞.'
        },
        {
            id: 'contact_info',
            title: '–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
            description: '–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏–π –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö',
            keywords: ['–∫–æ–Ω—Ç–∞–∫—Ç', '–æ–±—Ä–∞—â–µ–Ω–∏–µ', '–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ', 'email', '–ø–æ—á—Ç–∞', '—Ç–µ–ª–µ—Ñ–æ–Ω', '–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π', '—Å–≤—è–∑—å'],
            required: true,
            priority: 'high',
            lawRef: '–ø.8 —á.1 —Å—Ç.18.1 152-–§–ó',
            penalty: '–¥–æ 300 000 —Ä—É–±. (—Å—Ç. 13.11 –ö–æ–ê–ü –†–§)',
            recommendation: '–£–∫–∞–∂–∏—Ç–µ email –∏ —Ç–µ–ª–µ—Ñ–æ–Ω –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ.'
        },
        {
            id: 'legal_grounds',
            title: '–ü—Ä–∞–≤–æ–≤—ã–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏',
            description: '–°—Å—ã–ª–∫–∏ –Ω–∞ —Å—Ç–∞—Ç—å—é 6 152-–§–ó —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø—É–Ω–∫—Ç–∞–º–∏',
            keywords: ['—Å—Ç–∞—Ç—å—è 6', '–ø—É–Ω–∫—Ç 1', '–ø—É–Ω–∫—Ç 5', '–ø—É–Ω–∫—Ç 6', '—Å–æ–≥–ª–∞—Å–∏–µ', '–¥–æ–≥–æ–≤–æ—Ä', '–∑–∞–∫–æ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã', '–ø—Ä–∞–≤–æ–≤—ã–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è', '–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏'],
            required: true,
            priority: 'critical',
            lawRef: '–°—Ç.6 152-–§–ó',
            penalty: '–¥–æ 15 000 000 —Ä—É–±. (—á.7 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)',
            recommendation: '–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∞–≤–æ–≤—ã–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å –æ—Ç—Å—ã–ª–∫–æ–π –∫ —Å—Ç–∞—Ç—å–µ 6 152-–§–ó.'
        },
        {
            id: 'processing_purposes',
            title: '–¶–µ–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö',
            description: '–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–µ–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö',
            keywords: ['—Ü–µ–ª—å –æ–±—Ä–∞–±–æ—Ç–∫–∏', '—Ü–µ–ª–∏ —Å–±–æ—Ä–∞', '—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è', '–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞', '–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤', '–æ–∫–∞–∑–∞–Ω–∏–µ —É—Å–ª—É–≥'],
            required: true,
            priority: 'critical',
            lawRef: '–ø.3 —á.1 —Å—Ç.18.1 152-–§–ó',
            penalty: '–¥–æ 15 000 000 —Ä—É–±. (—á.7 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)',
            recommendation: '–£–∫–∞–∂–∏—Ç–µ —Ü–µ–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–∞–Ω–Ω—ã—Ö.'
        },
        {
            id: 'data_categories',
            title: '–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö',
            description: '–ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—á–µ–Ω—å –≤–∏–¥–æ–≤ —Å–æ–±–∏—Ä–∞–µ–º—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö',
            keywords: ['—Ñ–∞–º–∏–ª–∏—è', '–∏–º—è', '–æ—Ç—á–µ—Å—Ç–≤–æ', 'email', '–ø–æ—á—Ç–∞', '—Ç–µ–ª–µ—Ñ–æ–Ω', '–∞–¥—Ä–µ—Å', '–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–∞–Ω–Ω—ã—Ö', '–ø–∞—Å–ø–æ—Ä—Ç', '–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ'],
            required: true,
            priority: 'high',
            lawRef: '–ø.4 —á.1 —Å—Ç.18.1 152-–§–ó',
            penalty: '–¥–æ 10 000 000 —Ä—É–±. (—á.6 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)',
            recommendation: '–ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–æ–±–∏—Ä–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö.'
        },
        {
            id: 'subject_categories',
            title: '–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å—É–±—ä–µ–∫—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö',
            description: '–ü–µ—Ä–µ—á–µ–Ω—å –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ª–∏—Ü, —á—å–∏ –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è',
            keywords: ['—Å—É–±—ä–µ–∫—Ç', '–∫–ª–∏–µ–Ω—Ç', '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', '–ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å', '—Å–æ—Ç—Ä—É–¥–Ω–∏–∫', '–∑–∞–∫–∞–∑—á–∏–∫', '–ø–æ–∫—É–ø–∞—Ç–µ–ª—å'],
            required: true,
            priority: 'medium',
            lawRef: '–ø.4 —á.1 —Å—Ç.18.1 152-–§–ó',
            penalty: '–¥–æ 5 000 000 —Ä—É–±. (—á.6 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)',
            recommendation: '–ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å—É–±—ä–µ–∫—Ç–æ–≤: –∫–ª–∏–µ–Ω—Ç—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏ —Ç.–¥.'
        },
        {
            id: 'retention_periods',
            title: '–°—Ä–æ–∫–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö',
            description: '–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å—Ä–æ–∫–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–∞–Ω–Ω—ã—Ö',
            keywords: ['—Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è', '–ø–µ—Ä–∏–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏', '–≥–æ–¥', '–º–µ—Å—è—Ü', '—É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ', '—É–¥–∞–ª–µ–Ω–∏–µ', '—Ö—Ä–∞–Ω–∏—Ç—å', '–ø–µ—Ä–∏–æ–¥'],
            required: true,
            priority: 'critical',
            lawRef: '–ø.6 —á.1 —Å—Ç.18.1 152-–§–ó',
            penalty: '–¥–æ 15 000 000 —Ä—É–±. (—á.7 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)',
            recommendation: '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ä–æ–∫–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–∞–Ω–Ω—ã—Ö.'
        },
        {
            id: 'subject_rights',
            title: '–ü—Ä–∞–≤–∞ —Å—É–±—ä–µ–∫—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö',
            description: '–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∞–≤ —Å—É–±—ä–µ–∫—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ—Ä—è–¥–∫–∞ –∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏',
            keywords: ['–ø—Ä–∞–≤–∞ —Å—É–±—ä–µ–∫—Ç–∞', '–¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º', '–∏–∑–º–µ–Ω–µ–Ω–∏–µ', '—É–¥–∞–ª–µ–Ω–∏–µ', '–æ—Ç–∑—ã–≤ —Å–æ–≥–ª–∞—Å–∏—è', '–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞', '–¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏'],
            required: true,
            priority: 'critical',
            lawRef: '–°—Ç.14 152-–§–ó',
            penalty: '–¥–æ 10 000 000 —Ä—É–±. (—á.6 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)',
            recommendation: '–û–ø–∏—à–∏—Ç–µ –ø—Ä–∞–≤–∞ —Å—É–±—ä–µ–∫—Ç–æ–≤ –∏ –ø–æ—Ä—è–¥–æ–∫ –∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.'
        },
        {
            id: 'response_timeframe',
            title: '–°—Ä–æ–∫ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã',
            description: '–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å—Ä–æ–∫–∏ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã —Å—É–±—ä–µ–∫—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö',
            keywords: ['30 –¥–Ω–µ–π', '10 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π', '—Å—Ä–æ–∫ –æ—Ç–≤–µ—Ç–∞', '–æ—Ç–≤–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å', '—Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å', '–æ—Ç–≤–µ—Ç–∏—Ç—å'],
            required: true,
            priority: 'high',
            lawRef: '—á.4 —Å—Ç.14 152-–§–ó',
            penalty: '–¥–æ 5 000 000 —Ä—É–±. (—á.6 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)',
            recommendation: '–£–∫–∞–∂–∏—Ç–µ —Å—Ä–æ–∫ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã ‚Äî –Ω–µ –±–æ–ª–µ–µ 30 –¥–Ω–µ–π.'
        },
        {
            id: 'security_measures',
            title: '–ú–µ—Ä—ã –ø–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏',
            description: '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏',
            keywords: ['–∑–∞—â–∏—Ç–∞', '–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å', '—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ä—ã', '–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –º–µ—Ä—ã', '—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ', '–º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏'],
            required: true,
            priority: 'critical',
            lawRef: '–°—Ç.19 152-–§–ó',
            penalty: '–¥–æ 15 000 000 —Ä—É–±. (—á.7 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)',
            recommendation: '–û–ø–∏—à–∏—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ä—ã –∑–∞—â–∏—Ç—ã.'
        },
        {
            id: 'localization_2025',
            title: '–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (2025)',
            description: '–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–ª—å–∫–æ –≤ –†–æ—Å—Å–∏–∏',
            keywords: ['—Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è —Ä–æ—Å—Å–∏–∏', '—Ä–æ—Å—Å–∏–π—Å–∫–∞—è —Ñ–µ–¥–µ—Ä–∞—Ü–∏—è', '–ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è', '—Å–µ—Ä–≤–µ—Ä—ã –≤ —Ä–æ—Å—Å–∏–∏', '—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ä–æ—Å—Å–∏–∏', '–æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ —Ä–æ—Å—Å–∏–∏'],
            required: true,
            priority: 'critical',
            lawRef: '—á.5 —Å—Ç.18 152-–§–ó (—Å 01.07.2025)',
            penalty: '–¥–æ 18 000 000 —Ä—É–±. (—á.8 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§, —Å 01.07.2025)',
            recommendation: '–î–æ–±–∞–≤—å—Ç–µ —Ä–∞–∑–¥–µ–ª –æ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –†–æ—Å—Å–∏–∏.'
        },
        {
            id: 'registry_notification',
            title: '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä–∞',
            description: '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö',
            keywords: ['—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ä–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä–∞', '—Ä–µ–µ—Å—Ç—Ä –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤', '–ø–æ–¥–∞—á–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è', '—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è', '—É–≤–µ–¥–æ–º–∏—Ç—å', '–ø–æ–¥–∞—Ç—å'],
            required: true,
            priority: 'critical',
            lawRef: '–°—Ç.22 152-–§–ó',
            penalty: '–¥–æ 300 000 —Ä—É–±. (—Å—Ç. 19.7 –ö–æ–ê–ü –†–§)',
            recommendation: '–ü–æ–¥–∞–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä.'
        }
    ];
    let analysisData = null;
    // Authentication system
    const PASSWORD_HASH = '03ac674216f3e15c761ee1a5e255f067953623c8b388b4459e13f978d7c846f4'; // SHA-256 –¥–ª—è '1234'
    let authAttempts = parseInt(localStorage.getItem('privacy_audit_attempts') || '0');
    let authBlockedUntil = parseInt(localStorage.getItem('privacy_audit_blocked_until') || '0');
    // CapsLock indicator
    document.addEventListener('DOMContentLoaded', () => {
        const passInput = document.getElementById('authPassword');
        passInput.addEventListener('keyup', function(e) {
            const caps = e.getModifierState && e.getModifierState('CapsLock');
            document.getElementById('capsLockWarning').classList.toggle('hidden', !caps);
        });
        passInput.addEventListener('keydown', function(e) {
            const caps = e.getModifierState && e.getModifierState('CapsLock');
            document.getElementById('capsLockWarning').classList.toggle('hidden', !caps);
        });
    });
    // –°–±—Ä–æ—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
    setInterval(() => {
        if (authBlockedUntil && Date.now() > authBlockedUntil) {
            authAttempts = 0;
            authBlockedUntil = 0;
            localStorage.setItem('privacy_audit_attempts', '0');
            localStorage.setItem('privacy_audit_blocked_until', '0');
            hideAuthError();
        }
    }, 1000);
    // Section toggling
    function toggleSection(sectionId) {
        const content = document.getElementById(sectionId + 'Content');
        const icon = document.getElementById(sectionId + 'Icon');
        content.classList.toggle('active');
        icon.textContent = content.classList.contains('active') ? '‚ñ≤' : '‚ñº';
    }
    // Input method switching
    document.addEventListener('DOMContentLoaded', () => {
        const inputMethodRadios = document.querySelectorAll('input[name="inputMethod"]');
        const urlContainer = document.getElementById('urlInputContainer');
        const textContainer = document.getElementById('textInputContainer');
        inputMethodRadios.forEach(radio => {
            radio.addEventListener('change', (event) => {
                if (event.target.value === 'url') {
                    urlContainer.classList.remove('hidden');
                    textContainer.classList.add('hidden');
                } else {
                    urlContainer.classList.add('hidden');
                    textContainer.classList.remove('hidden');
                }
                clearResults();
            });
        });
        document.getElementById('authPassword').addEventListener('keypress', e => {
            if (e.key === 'Enter') authenticate();
        });
    });
    // Alert functions
    function showAlert(msg, type = 'error') {
        const alertEl = document.getElementById(type === 'error' ? 'errorAlert' : 'successAlert');
        alertEl.querySelector('p').textContent = msg;
        alertEl.classList.remove('hidden');
        setTimeout(() => alertEl.classList.add('hidden'), 5000);
    }
    function clearResults() {
        document.getElementById('policyUrl').value = '';
        document.getElementById('policyText').value = '';
        document.getElementById('results').classList.add('hidden');
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('successAlert').classList.add('hidden');
        document.getElementById('errorAlert').classList.add('hidden');
    }
    // –ù–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω—ã—Ö URL –¥–ª—è –ø–æ–ª–∏—Ç–∏–∫–∏
    const POLICY_PATHS = [
        '/politics', '/privacy', '/policy', '/privacy-policy', '/politika', '/politika-konfidencialnosti'
    ];
    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª–∏—Ç–∏–∫–∏
    async function findPolicyPage(baseUrl) {
        // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—É—Ç–∏
        for (const path of POLICY_PATHS) {
            try {
                const testUrl = new URL(path, baseUrl).href;
                const resp = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(testUrl)}`);
                if (resp.ok) {
                    const text = await resp.text();
                    if (/–ø–æ–ª–∏—Ç–∏–∫–∞|–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ|privacy|policy/i.test(text)) {
                        return { url: testUrl, content: text };
                    }
                }
            } catch (e) { /* –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ */ }
        }
        // 2. –ü–∞—Ä—Å–∏–º –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –∏—â–µ–º —Å—Å—ã–ª–∫–∏
        try {
            const resp = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(baseUrl)}`);
            if (!resp.ok) return null;
            const html = await resp.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const links = Array.from(doc.querySelectorAll('a'));
            for (const link of links) {
                const href = link.getAttribute('href');
                if (href && /–ø–æ–ª–∏—Ç–∏–∫–∞|privacy|policy|–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ/i.test(link.textContent + ' ' + href)) {
                    let fullUrl = href.startsWith('http') ? href : new URL(href, baseUrl).href;
                    try {
                        const resp2 = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(fullUrl)}`);
                        if (resp2.ok) {
                            const text2 = await resp2.text();
                            if (/–ø–æ–ª–∏—Ç–∏–∫–∞|–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ|privacy|policy/i.test(text2)) {
                                return { url: fullUrl, content: text2 };
                            }
                        }
                    } catch (e) { /* –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º */ }
                }
            }
        } catch (e) { /* –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º */ }
        return null;
    }
    // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è analyzePolicy
    async function analyzePolicy() {
        document.getElementById('successAlert').classList.add('hidden');
        document.getElementById('errorAlert').classList.add('hidden');
        document.getElementById('results').classList.add('hidden');
        document.getElementById('loading').classList.add('hidden');

        const isUrl = document.querySelector('input[name="inputMethod"]:checked').value === 'url';
        let content = '';
        let foundPolicyUrl = '';

        if (isUrl) {
            let url = document.getElementById('policyUrl').value.trim();
            if (!url) return showAlert('–£–∫–∞–∂–∏—Ç–µ URL —Å–∞–π—Ç–∞ –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞');
            if (!/^https?:\/\//.test(url)) return showAlert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π URL');
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('analyzeBtn').disabled = true;
            let policyData = null;
            try {
                // –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª–∏—Ç–∏–∫–∏, –∏—â–µ–º –µ—ë
                policyData = await findPolicyPage(url);
                if (!policyData) throw new Error('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                content = policyData.content;
                foundPolicyUrl = policyData.url;
            } catch (error) {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('analyzeBtn').disabled = false;
                return showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–ª–∏—Ç–∏–∫–∏');
            }
            // –û—á–∏—â–∞–µ–º –æ—Ç html —Ç–µ–≥–æ–≤
            const parser = new DOMParser();
            const doc = parser.parseFromString(content, 'text/html');
            const elementsToRemove = ['script', 'style', 'nav', 'header', 'footer', 'aside', '.menu', '.navigation', '.ads', '.sidebar'];
            elementsToRemove.forEach(selector => {
                doc.querySelectorAll(selector).forEach(el => el.remove());
            });
            content = doc.body ? (doc.body.textContent || doc.body.innerText || '') : '';
            content = content.replace(/\s+/g, ' ').trim();
            if (!content || content.length < 200) {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('analyzeBtn').disabled = false;
                return showAlert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞');
            }
        } else {
            content = document.getElementById('policyText').value.trim();
            if (content.length < 200) return showAlert('–¢–µ–∫—Å—Ç —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π');
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('analyzeBtn').disabled = true;
        }
        await new Promise(r => setTimeout(r, 1200));
        analysisData = performImprovedAnalysis(content);
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('analyzeBtn').disabled = false;
        displayResults();
        if (foundPolicyUrl) {
            showAlert('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ù–∞–π–¥–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª–∏—Ç–∏–∫–∏: ' + foundPolicyUrl, 'success');
        } else {
            showAlert('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'success');
        }
    }
    // Improved analysis function
    function performImprovedAnalysis(content) {
        // –ù–æ–≤—ã–π —Å—Ç—Ä–æ–≥–∏–π –∞–Ω–∞–ª–∏–∑: –∏—â–µ–º —è–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã –∏ –¥–∞–Ω–Ω—ã–µ
        const contentLower = content.toLowerCase().replace(/[^a-z–∞-—è—ë0-9\s]/gi, ' ').replace(/\s+/g, ' ').trim();
        let results = [];
        let recommendations = [];
        let criticalIssues = 0;
        let highIssues = 0;
        let passedCount = 0;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∞—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        const datePattern = /(–æ–±–Ω–æ–≤–ª–µ–Ω[–∞-—è]*|–¥–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è|–¥–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏|–¥–∞—Ç–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)[^\d]*(\d{2,4}[\.\/-]\d{1,2}[\.\/-]\d{2,4})/i;
        const hasDate = datePattern.test(content);
        results.push({
            id: 'update_date',
            title: '–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏',
            description: '–í –ø–æ–ª–∏—Ç–∏–∫–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —è–≤–Ω–æ —É–∫–∞–∑–∞–Ω–∞ –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–ª–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.',
            lawRef: '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä–∞',
            penalty: '–†–∏—Å–∫ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä–∞)',
            passed: hasDate,
            matches: hasDate ? 1 : 0,
            totalKeywords: 1,
            matchRatio: hasDate ? 100 : 0,
            priority: 'high',
        });
        if (!hasDate) {
            highIssues++;
            recommendations.push({
                title: '–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏',
                description: '–í –ø–æ–ª–∏—Ç–∏–∫–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.',
                lawRef: '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä–∞',
                penalty: '–†–∏—Å–∫ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä–∞)',
                recommendation: '–î–æ–±–∞–≤—å—Ç–µ –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–ª–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏.',
                priority: 'high',
            });
        } else {
            passedCount++;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è email, —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –∞–¥—Ä–µ—Å–∞
        const emailPattern = /[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}/i;
        const phonePattern = /(\+7|8)[\s\-\(]?(\d{3})[\)\-\s]?(\d{3})[\-\s]?(\d{2})[\-\s]?(\d{2})/;
        const addressPattern = /(–≥\.|–≥–æ—Ä–æ–¥|—É–ª\.|—É–ª–∏—Ü–∞|–ø—Ä–æ—Å–ø–µ–∫—Ç|–¥–æ–º|–æ—Ñ–∏—Å|–∞–¥—Ä–µ—Å)/i;
        const hasEmail = emailPattern.test(content);
        const hasPhone = phonePattern.test(content);
        const hasAddress = addressPattern.test(content);
        const contactsPassed = hasEmail && hasPhone && hasAddress;
        results.push({
            id: 'contacts_explicit',
            title: '–Ø–≤–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ',
            description: '–í –ø–æ–ª–∏—Ç–∏–∫–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —è–≤–Ω–æ —É–∫–∞–∑–∞–Ω—ã email, —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –∞–¥—Ä–µ—Å.',
            lawRef: '–ø.8 —á.1 —Å—Ç.18.1 152-–§–ó',
            penalty: '–¥–æ 300 000 —Ä—É–±. (—Å—Ç. 13.11 –ö–æ–ê–ü –†–§)',
            passed: contactsPassed,
            matches: [hasEmail, hasPhone, hasAddress].filter(Boolean).length,
            totalKeywords: 3,
            matchRatio: Math.round([hasEmail, hasPhone, hasAddress].filter(Boolean).length / 3 * 100),
            priority: 'critical',
        });
        if (!contactsPassed) {
            criticalIssues++;
            recommendations.push({
                title: '–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ',
                description: '–í –ø–æ–ª–∏—Ç–∏–∫–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç email, —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ –∞–¥—Ä–µ—Å.',
                lawRef: '–ø.8 —á.1 —Å—Ç.18.1 152-–§–ó',
                penalty: '–¥–æ 300 000 —Ä—É–±. (—Å—Ç. 13.11 –ö–æ–ê–ü –†–§)',
                recommendation: '–£–∫–∞–∂–∏—Ç–µ email, —Ç–µ–ª–µ—Ñ–æ–Ω –∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å –¥–ª—è —Å–≤—è–∑–∏ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.',
                priority: 'critical',
            });
        } else {
            passedCount++;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–æ–≤—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π 2025 –≥–æ–¥–∞
        const localization2025 = /(–ª–æ–∫–∞–ª–∏–∑–∞—Ü|—Å–µ—Ä–≤–µ—Ä[–∞-—è]* –≤ —Ä–æ—Å—Å–∏–∏|—Ö—Ä–∞–Ω–µ–Ω–∏[–µ—è] –≤ —Ä–æ—Å—Å–∏–∏|–æ–±—Ä–∞–±–æ—Ç–∫[–∞–µ–∏] –≤ —Ä–æ—Å—Å–∏–∏|—Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏[—è–∏] —Ä–æ—Å—Å–∏–∏|—Ä–æ—Å—Å–∏–π—Å–∫–∞—è —Ñ–µ–¥–µ—Ä–∞—Ü–∏—è)/i.test(content);
        const separateConsent2025 = /(–æ—Ç–¥–µ–ª—å–Ω[–∞-—è]* —Å–æ–≥–ª–∞—Å–∏–µ|–æ—Ç–¥–µ–ª—å–Ω[–∞-—è]* –¥–æ–∫—É–º–µ–Ω—Ç|–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –¥–æ–≥–æ–≤–æ—Ä–∞|—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω[–∞-—è]*)/i.test(content);
        const incidentNotification2025 = /(–∏–Ω—Ü–∏–¥–µ–Ω—Ç|24 —á–∞—Å|—É—Ç–µ—á–∫[–∞–µ–∏]|—Ä–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä|—É–≤–µ–¥–æ–º–ª–µ–Ω–∏[–µ—è] –æ–± –∏–Ω—Ü–∏–¥–µ–Ω—Ç|–Ω–∞—Ä—É—à–µ–Ω–∏[–µ—è] –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç|—Å–æ–æ–±—â–∏—Ç—å)/i.test(content);
        if (!localization2025) {
            criticalIssues++;
            recommendations.push({
                title: '–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (2025)',
                description: '–ù–µ—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ —Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–ª—å–∫–æ –≤ –†–æ—Å—Å–∏–∏.',
                lawRef: '—á.5 —Å—Ç.18 152-–§–ó (—Å 01.07.2025)',
                penalty: '–¥–æ 18 000 000 —Ä—É–±. (—á.8 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§, —Å 01.07.2025)',
                recommendation: '–î–æ–±–∞–≤—å—Ç–µ —Ä–∞–∑–¥–µ–ª –æ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞–∂–¥–∞–Ω –†–§ –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –†–æ—Å—Å–∏–∏.',
                priority: 'critical',
            });
        } else {
            passedCount++;
        }
        if (!incidentNotification2025) {
            criticalIssues++;
            recommendations.push({
                title: '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞—Ö (2025)',
                description: '–ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ—Ä—è–¥–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä–∞ –æ–± –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞—Ö.',
                lawRef: '—á.6 —Å—Ç.21 152-–§–ó (—Å 30.05.2025)',
                penalty: '–¥–æ 20 000 000 —Ä—É–±. (—á.11 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§, —Å 30.05.2025)',
                recommendation: '–î–æ–±–∞–≤—å—Ç–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç—å —É–≤–µ–¥–æ–º–ª—è—Ç—å –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä –æ–± –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞—Ö –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤.',
                priority: 'critical',
            });
        } else {
            passedCount++;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ (–ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º)
        const requiredSections = [
            {id: 'general_provisions', title: '–û–±—â–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è', example: '–ù–∞—Å—Ç–æ—è—â–µ–µ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ (–¥–∞–ª–µ–µ –ø–æ —Ç–µ–∫—Å—Ç—É ‚Äî –°–æ–≥–ª–∞—à–µ–Ω–∏–µ) —è–≤–ª—è–µ—Ç—Å—è –ø—É–±–ª–∏—á–Ω–æ–π –æ—Ñ–µ—Ä—Ç–æ–π –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —É—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤, —Ä–∞–∑–º–µ—â–µ–Ω–Ω—ã—Ö –Ω–∞ —Å–∞–π—Ç–µ –≤ —Å–µ—Ç–∏ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –ø–æ –∞–¥—Ä–µ—Å—É www.example.ru (–¥–∞–ª–µ–µ ‚Äî –°–∞–π—Ç), –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (–¥–∞–ª–µ–µ ‚Äî –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ), –≤ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º –ö–∏–æ—Å–∫–µ. –°–∞–π—Ç, –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ö–∏–æ—Å–∫ —è–≤–ª—è—é—Ç—Å—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é –û–û–û "–ö–æ–º–ø–∞–Ω–∏—è" (–û–ì–†–ù –•–•–•–•–•–•–•–•, –ò–ù–ù –•–•–•–•–•–•–•–•) –∏ —Å–æ–∑–¥–∞–Ω—ã –≤ —Ü–µ–ª—è—Ö –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è —Å –û–û–û "–ö–æ–º–ø–∞–Ω–∏—è", —Å –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–æ–º –ø—Ä–æ–¥—É–∫—Ü–∏–∏, –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å–ø—Ä–æ—Å–∞ –Ω–∞ —Ç–æ–≤–∞—Ä—ã, –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–≤–µ—Ä—à–∏—Ç—å –ø–æ–∫—É–ø–∫—É. –ù–∞—Å—Ç–æ—è—â–µ–µ –°–æ–≥–ª–∞—à–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ –≤—Å–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—É—é –û–û–û "–ö–æ–º–ø–∞–Ω–∏—è" (–û–ì–†–ù –•–•–•–•–•–•–•–•) –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –æ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –≤–æ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–º –°–∞–π—Ç–∞, –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ö–∏–æ—Å–∫–∞, —Å–µ—Ä–≤–∏—Å–æ–≤, —Å–ª—É–∂–±, –ø—Ä–æ–≥—Ä–∞–º–º –¥–ª—è –≠–í–ú (–¥–∞–ª–µ–µ ‚Äî –°–µ—Ä–≤–∏—Å—ã). –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –°–µ—Ä–≤–∏—Å—ã, –∞ —Ç–∞–∫–∂–µ –ª—é–±–æ–µ –∏—Ö —Ä–∞–∑–≤–∏—Ç–∏–µ –∏/–∏–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —è–≤–ª—è—é—Ç—Å—è –ø—Ä–µ–¥–º–µ—Ç–æ–º –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –°–æ–≥–ª–∞—à–µ–Ω–∏—è.'},
            {id: 'operator_details', title: '–°–≤–µ–¥–µ–Ω–∏—è –æ–± –æ–ø–µ—Ä–∞—Ç–æ—Ä–µ', example: '–û–û–û "–ö–æ–º–ø–∞–Ω–∏—è", –û–ì–†–ù –•–•–•–•–•–•–•–•, –ò–ù–ù –•–•–•–•–•–•–•–•, —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å: –•–•–•–•–•–•–•–•.'},
            {id: 'legal_grounds', title: '–ü—Ä–∞–≤–æ–≤—ã–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏', example: '–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —Å—Ç. 6 –§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∑–∞–∫–æ–Ω–∞ ‚Ññ 152-–§–ó, –∞ —Ç–∞–∫–∂–µ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —Å–æ–≥–ª–∞—Å–∏—è —Å—É–±—ä–µ–∫—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.'},
            {id: 'processing_purposes', title: '–¶–µ–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö', example: '–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–∏—Å–∞–º, –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤, –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏, —É—á–∞—Å—Ç–∏—è –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–∫–∞—Ö, –∞ —Ç–∞–∫–∂–µ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –†–§.'},
            {id: 'data_categories', title: '–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö', example: '–§–∞–º–∏–ª–∏—è, –∏–º—è, –æ—Ç—á–µ—Å—Ç–≤–æ, –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ç–µ–ª–µ—Ñ–æ–Ω, email), –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏, –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤, —Å–≤–µ–¥–µ–Ω–∏—è –æ –ø–ª–∞—Ç–µ–∂–∞—Ö.'},
            {id: 'subject_rights', title: '–ü—Ä–∞–≤–∞ —Å—É–±—ä–µ–∫—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö', example: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–≤–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, –æ—Ç–∑—ã–≤ —Å–æ–≥–ª–∞—Å–∏—è, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏, –∞ —Ç–∞–∫–∂–µ –Ω–∞ –ø–æ–¥–∞—á—É –∂–∞–ª–æ–±—ã –≤ –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä.'},
            {id: 'retention_periods', title: '–°—Ä–æ–∫–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö', example: '–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞, –∞ —Ç–∞–∫–∂–µ –≤ —Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º –†–§.'},
            {id: 'security_measures', title: '–ú–µ—Ä—ã –ø–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏', example: '–û–ø–µ—Ä–∞—Ç–æ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ä—ã –¥–ª—è –∑–∞—â–∏—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç –Ω–µ–ø—Ä–∞–≤–æ–º–µ—Ä–Ω–æ–≥–æ –∏–ª–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞, —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è, –∏–∑–º–µ–Ω–µ–Ω–∏—è, –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è, –∞ —Ç–∞–∫–∂–µ –æ—Ç –∏–Ω—ã—Ö –Ω–µ–ø—Ä–∞–≤–æ–º–µ—Ä–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π.'},
            {id: 'registry_notification', title: '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä–∞', example: '–û–ø–µ—Ä–∞—Ç–æ—Ä —É–≤–µ–¥–æ–º–ª—è–µ—Ç –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä –æ –Ω–∞—á–∞–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ø–æ—Ä—è–¥–∫–µ, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–º –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º –†–§.'},
            {id: 'localization_2025', title: '–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (2025)', example: '–í –ø–æ–ª–∏—Ç–∏–∫–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å: "–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞–∂–¥–∞–Ω –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –†–§."'}
        ];
        requiredSections.forEach(section => {
            const found = new RegExp(section.title, 'i').test(content);
            results.push({
                id: section.id,
                title: section.title,
                description: `–ù–∞–ª–∏—á–∏–µ —Ä–∞–∑–¥–µ–ª–∞ "${section.title}"`,
                lawRef: (() => {
                    switch(section.id) {
                        case 'general_provisions': return '–°—Ç. 18.1 152-–§–ó';
                        case 'operator_details': return '–ø.1 —á.1 —Å—Ç.18.1 152-–§–ó';
                        case 'legal_grounds': return '–°—Ç.6 152-–§–ó';
                        case 'processing_purposes': return '–ø.3 —á.1 —Å—Ç.18.1 152-–§–ó';
                        case 'data_categories': return '–ø.4 —á.1 —Å—Ç.18.1 152-–§–ó';
                        case 'subject_rights': return '–°—Ç.14 152-–§–ó';
                        case 'retention_periods': return '–ø.6 —á.1 —Å—Ç.18.1 152-–§–ó';
                        case 'security_measures': return '–°—Ç.19 152-–§–ó';
                        case 'registry_notification': return '–°—Ç.22 152-–§–ó';
                        case 'localization_2025': return '—á.5 —Å—Ç.18 152-–§–ó (—Å 01.07.2025)';
                        default: return '152-–§–ó';
                    }
                })(),
                penalty: (() => {
                    switch(section.id) {
                        case 'general_provisions': return '–¥–æ 300 000 —Ä—É–±. (—Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                        case 'operator_details': return '–¥–æ 300 000 —Ä—É–±. (—Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                        case 'legal_grounds': return '–¥–æ 15 000 000 —Ä—É–±. (—á.7 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                        case 'processing_purposes': return '–¥–æ 15 000 000 —Ä—É–±. (—á.7 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                        case 'data_categories': return '–¥–æ 10 000 000 —Ä—É–±. (—á.6 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                        case 'subject_rights': return '–¥–æ 10 000 000 —Ä—É–±. (—á.6 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                        case 'retention_periods': return '–¥–æ 15 000 000 —Ä—É–±. (—á.7 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                        case 'security_measures': return '–¥–æ 15 000 000 —Ä—É–±. (—á.7 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                        case 'registry_notification': return '–¥–æ 300 000 —Ä—É–±. (—Å—Ç. 19.7 –ö–æ–ê–ü –†–§)';
                        case 'localization_2025': return '–¥–æ 18 000 000 —Ä—É–±. (—á.8 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§, —Å 01.07.2025)';
                        default: return '–¥–æ 300 000 —Ä—É–±. (—Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                    }
                })(),
                passed: found,
                matches: found ? 1 : 0,
                totalKeywords: 1,
                matchRatio: found ? 100 : 0,
                priority: 'high',
            });
            if (!found) {
                highIssues++;
                recommendations.push({
                    title: section.title,
                    description: `–í –ø–æ–ª–∏—Ç–∏–∫–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ä–∞–∑–¥–µ–ª "${section.title}"`,
                    lawRef: (() => {
                        switch(section.id) {
                            case 'general_provisions': return '–°—Ç. 18.1 152-–§–ó';
                            case 'operator_details': return '–ø.1 —á.1 —Å—Ç.18.1 152-–§–ó';
                            case 'legal_grounds': return '–°—Ç.6 152-–§–ó';
                            case 'processing_purposes': return '–ø.3 —á.1 —Å—Ç.18.1 152-–§–ó';
                            case 'data_categories': return '–ø.4 —á.1 —Å—Ç.18.1 152-–§–ó';
                            case 'subject_rights': return '–°—Ç.14 152-–§–ó';
                            case 'retention_periods': return '–ø.6 —á.1 —Å—Ç.18.1 152-–§–ó';
                            case 'security_measures': return '–°—Ç.19 152-–§–ó';
                            case 'registry_notification': return '–°—Ç.22 152-–§–ó';
                            case 'localization_2025': return '—á.5 —Å—Ç.18 152-–§–ó (—Å 01.07.2025)';
                            default: return '152-–§–ó';
                        }
                    })(),
                    penalty: (() => {
                        switch(section.id) {
                            case 'general_provisions': return '–¥–æ 300 000 —Ä—É–±. (—Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                            case 'operator_details': return '–¥–æ 300 000 —Ä—É–±. (—Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                            case 'legal_grounds': return '–¥–æ 15 000 000 —Ä—É–±. (—á.7 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                            case 'processing_purposes': return '–¥–æ 15 000 000 —Ä—É–±. (—á.7 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                            case 'data_categories': return '–¥–æ 10 000 000 —Ä—É–±. (—á.6 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                            case 'subject_rights': return '–¥–æ 10 000 000 —Ä—É–±. (—á.6 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                            case 'retention_periods': return '–¥–æ 15 000 000 —Ä—É–±. (—á.7 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                            case 'security_measures': return '–¥–æ 15 000 000 —Ä—É–±. (—á.7 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                            case 'registry_notification': return '–¥–æ 300 000 —Ä—É–±. (—Å—Ç. 19.7 –ö–æ–ê–ü –†–§)';
                            case 'localization_2025': return '–¥–æ 18 000 000 —Ä—É–±. (—á.8 —Å—Ç. 13.11 –ö–æ–ê–ü –†–§, —Å 01.07.2025)';
                            default: return '–¥–æ 300 000 —Ä—É–±. (—Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                        }
                    })(),
                    recommendation: `–î–æ–±–∞–≤—å—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–∞–∑–¥–µ–ª "${section.title}" –≤ –ø–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏. –ü—Ä–∏–º–µ—Ä —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏: ${section.example}`,
                    priority: 'high',
                });
            } else {
                passedCount++;
            }
        });

        // –°—Ç–∞—Ä—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º (–æ—Å—Ç–∞–≤–ª—è–µ–º –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã)
        COMPLIANCE_CHECKS.forEach(check => {
            let matches = 0;
            const totalKeywords = check.keywords.length;
            check.keywords.forEach(keyword => {
                const keywordLower = keyword.toLowerCase().replace(/[^a-z–∞-—è—ë0-9\s]/gi, ' ');
                const patterns = [
                    new RegExp('\\b' + keywordLower.replace(/\s+/g, '\\s+') + '\\b', 'gi'),
                    new RegExp(keywordLower.replace(/\s+/g, '.*?'), 'gi')
                ];
                if (patterns.some(pattern => pattern.test(contentLower))) {
                    matches++;
                }
            });
            let threshold = 0.3;
            if (check.priority === 'critical') threshold = 0.5;
            else if (check.priority === 'high') threshold = 0.4;
            else if (check.priority === 'medium') threshold = 0.3;
            else threshold = 0.2;
            const matchRatio = matches / totalKeywords;
            const passed = matchRatio >= threshold;
            if (passed) {
                passedCount++;
            } else {
                if (check.priority === 'critical') criticalIssues++;
                else if (check.priority === 'high') highIssues++;
                recommendations.push({
                    title: check.title,
                    description: check.description,
                    lawRef: check.lawRef,
                    penalty: check.penalty,
                    recommendation: check.recommendation,
                    priority: check.priority,
                    id: check.id
                });
            }
            results.push({
                ...check,
                passed,
                matches,
                totalKeywords,
                matchRatio: Math.round(matchRatio * 100)
            });
        });
        // –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏ –ø–æ id (–æ—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–π –Ω–∞–π–¥–µ–Ω–Ω—ã–π)
        const uniqueResults = [];
        const seenResultIds = new Set();
        for (const r of results) {
            if (!seenResultIds.has(r.id)) {
                uniqueResults.push(r);
                seenResultIds.add(r.id);
            }
        }
        results = uniqueResults;
        // –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏ –ø–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É title (—Å—Ç—Ä–æ–≥–æ, –±–µ–∑ —É—á—ë—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞ –∏ –ø—Ä–æ–±–µ–ª–æ–≤)
        const recObj = {};
        for (const rec of recommendations) {
            const key = rec.title ? rec.title.replace(/\s+/g, '').toLowerCase() : '';
            if (key && !recObj[key]) {
                recObj[key] = rec;
            }
        }
        recommendations = Object.values(recObj);
        const totalChecks = results.length;
        const score = Math.round((passedCount / totalChecks) * 100);
        let riskLevel = 'low';
        if (criticalIssues >= 3 || score < 40) riskLevel = 'critical';
        else if (criticalIssues >= 1 || highIssues >= 3 || score < 70) riskLevel = 'high';
        else if (highIssues >= 1 || score < 85) riskLevel = 'medium';
        return {
            score,
            results,
            recommendations,
            criticalIssues,
            highIssues,
            passedCount,
            totalChecks,
            riskLevel
        };
    }
    // Display results
    function displayResults() {
        const {score, results, recommendations, riskLevel, passedCount, totalChecks} = analysisData;
        const scoreEl = document.getElementById('scoreValue');
        const circleEl = document.getElementById('scoreCircle');
        const titleEl = document.getElementById('scoreTitle');
        const descEl = document.getElementById('scoreDesc');
        const riskEl = document.getElementById('riskIndicator');
        scoreEl.textContent = score + '%';
        if (score >= 85) {
            circleEl.className = 'w-16 h-16 rounded-full flex items-center justify-center text-white font-bold bg-green-500';
            titleEl.textContent = '–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è';
            descEl.textContent = `–í—ã–ø–æ–ª–Ω–µ–Ω–æ ${passedCount} –∏–∑ ${totalChecks} —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π`;
        } else if (score >= 70) {
            circleEl.className = 'w-16 h-16 rounded-full flex items-center justify-center text-white font-bold bg-yellow-500';
            titleEl.textContent = '–¢—Ä–µ–±—É—é—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∏';
            descEl.textContent = `–í—ã–ø–æ–ª–Ω–µ–Ω–æ ${passedCount} –∏–∑ ${totalChecks} —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π`;
        } else {
            circleEl.className = 'w-16 h-16 rounded-full flex items-center justify-center text-white font-bold bg-red-500';
            titleEl.textContent = '–°–µ—Ä—å—ë–∑–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è';
            descEl.textContent = `–í—ã–ø–æ–ª–Ω–µ–Ω–æ ${passedCount} –∏–∑ ${totalChecks} —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π`;
        }
        const riskTexts = {
            'critical': '–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –†–ò–°–ö',
            'high': '–í–´–°–û–ö–ò–ô –†–ò–°–ö',
            'medium': '–°–†–ï–î–ù–ò–ô –†–ò–°–ö',
            'low': '–ù–ò–ó–ö–ò–ô –†–ò–°–ö'
        };
        const riskColors = {
            'critical': 'bg-red-500 text-white',
            'high': 'bg-orange-500 text-white',
            'medium': 'bg-yellow-500 text-white',
            'low': 'bg-green-500 text-white'
        };
        riskEl.textContent = riskTexts[riskLevel];
        riskEl.className = `px-3 py-1 rounded-lg font-semibold text-sm ${riskColors[riskLevel]}`;
        const checksContainer = document.getElementById('checksContainer');
        checksContainer.innerHTML = '';
        results.forEach(result => {
            const item = document.createElement('div');
            item.className = `result-item p-3 rounded-lg ${result.passed ? 'success' : result.priority === 'critical' ? 'error' : 'warning'}`;
            const statusIcon = result.passed ? '‚úì' : '‚úó';
            const statusClass = result.passed ? 'status-success' : result.priority === 'critical' ? 'status-error' : 'status-warning';
            let matchInfo = '';
            if (result.id !== 'localization_2025') {
                matchInfo = `<p class="text-gray-500 text-xs mt-1">–°–æ–≤–ø–∞–¥–µ–Ω–∏–π: ${result.matches}/${result.totalKeywords} (${result.matchRatio}%)</p>`;
            }
            // penalty compact
            let penaltyText = result.penalty && result.penalty.trim() ? result.penalty : '–¥–æ 300 000 —Ä—É–±. (—Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
            item.innerHTML = `
                <div class="flex items-start gap-3">
                    <div class="${statusClass} status-icon">${statusIcon}</div>
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                            <h4 class="font-semibold text-gray-900 text-sm">${result.title}</h4>
                        </div>
                        <p class="text-gray-700 text-sm mb-1">${result.description}</p>
                        <p class="text-blue-600 text-xs">${result.lawRef}</p>
                        ${!result.passed ? `<p class="text-red-600 text-xs font-medium mt-1">–í–æ–∑–º–æ–∂–Ω—ã–π —à—Ç—Ä–∞—Ñ: ${penaltyText}</p>` : ''}
                        ${matchInfo}
                    </div>
                </div>
            `;
            checksContainer.appendChild(item);
        });
        const recList = document.getElementById('recList');
        recList.innerHTML = '';
        if (recommendations.length > 0) {
            recommendations.forEach(rec => {
                const recDiv = document.createElement('div');
                recDiv.className = 'bg-gray-50 p-3 rounded-lg border border-gray-200';
                let penaltyText = rec.penalty && rec.penalty.trim() ? rec.penalty : '–¥–æ 300 000 —Ä—É–±. (—Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                recDiv.innerHTML = `
                    <h5 class="font-semibold text-gray-900 mb-2 text-sm">${rec.title}</h5>
                    <p class="text-gray-900 text-sm mb-2"><strong>–ß—Ç–æ –¥–µ–ª–∞—Ç—å:</strong> ${rec.recommendation}</p>
                    <p class="text-blue-600 text-sm mb-2"><strong>–ü—Ä–∞–≤–æ–≤–æ–µ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ:</strong> ${rec.lawRef}</p>
                    <p class="text-red-600 text-sm font-medium"><strong>–í–æ–∑–º–æ–∂–Ω—ã–π —à—Ç—Ä–∞—Ñ:</strong> ${penaltyText}</p>
                `;
                recList.appendChild(recDiv);
            });
        } else {
            recList.innerHTML = '<div class="bg-green-50 p-3 rounded-lg border border-green-200"><p class="text-green-800 font-medium">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ</p><p class="text-green-700 text-sm">–ü–æ–ª–∏—Ç–∏–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º 152-–§–ó.</p></div>';
        }
        document.getElementById('results').classList.remove('hidden');
    }
    // Download report with correct encoding
    function downloadReport(format) {
        if (!analysisData) return showAlert('–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É');
        const reportText = generateDetailedReport();
        if (format === 'txt') {
            downloadAsText(reportText, 'otchet_o_problemakh_politiki.txt');
        } else if (format === 'html') {
            downloadAsHtml(reportText, 'otchet_o_problemakh_politiki.html');
        }
        showAlert('–û—Ç—á–µ—Ç —Å–∫–∞—á–∞–Ω', 'success');
    }
    function downloadAsText(content, filename) {
        const BOM = '\uFEFF';
        const blob = new Blob([BOM + content], {type: 'text/plain;charset=utf-8'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
    function downloadAsHtml(content, filename) {
        const htmlContent = `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <title>–û—Ç—á—ë—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</title>
                <style>
                    body { font-family: 'Times New Roman', serif; line-height: 1.6; margin: 2cm; }
                    h1, h2, h3 { color: #333; }
                    .critical { color: #dc2626; font-weight: bold; }
                    .important { color: #ea580c; font-weight: bold; }
                    .normal { color: #059669; }
                </style>
            </head>
            <body>
                ${content.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}
            </body>
            </html>
        `;
        const blob = new Blob(['\ufeff', htmlContent], {
            type: 'text/html;charset=utf-8'
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
    function generateDetailedReport() {
        const reportDate = new Date().toLocaleString('ru-RU');
        const {score, results, recommendations, criticalIssues, riskLevel} = analysisData;
        let report = `–û–¢–ß–Å–¢ –û –ü–†–û–í–ï–†–ö–ï –ü–û–õ–ò–¢–ò–ö–ò –ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–ò\n–î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è: ${reportDate}\n\n–û–±—â–∏–π –±–∞–ª–ª —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è: ${score}%\n–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: ${riskLevel.toUpperCase()}\n\n–í–´–Ø–í–õ–ï–ù–ù–´–ï –ù–ê–†–£–®–ï–ù–ò–Ø:`;
        let problemCount = 1;
        // –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏ –ø–æ id (–æ—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–π –Ω–∞–π–¥–µ–Ω–Ω—ã–π)
        const uniqueResults = [];
        const seenResultIds = new Set();
        for (const r of results) {
            if (!r.passed && !seenResultIds.has(r.id)) {
                uniqueResults.push(r);
                seenResultIds.add(r.id);
            }
        }
        uniqueResults.forEach(result => {
            let penaltyText = result.penalty && result.penalty.trim() ? result.penalty : '–¥–æ 300 000 —Ä—É–±. (—Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
            report += `\n${problemCount}. ${result.title}\n   –û–ø–∏—Å–∞–Ω–∏–µ: ${result.description}\n   –ü—Ä–∞–≤–æ–≤–æ–µ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ: ${result.lawRef}\n   –í–æ–∑–º–æ–∂–Ω—ã–π —à—Ç—Ä–∞—Ñ: ${penaltyText}`;
            if (result.id !== 'localization_2025') {
                report += `\n   –°–æ–≤–ø–∞–¥–µ–Ω–∏–π: ${result.matches}/${result.totalKeywords} (${result.matchRatio}%)`;
            }
            report += `\n`;
            problemCount++;
        });
        // –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏ –ø–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É title (—Å—Ç—Ä–æ–≥–æ, –±–µ–∑ —É—á—ë—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞ –∏ –ø—Ä–æ–±–µ–ª–æ–≤)
        const recObj = {};
        for (const rec of recommendations) {
            const key = rec.title ? rec.title.replace(/\s+/g, '').toLowerCase() : '';
            if (key && !recObj[key]) {
                recObj[key] = rec;
            }
        }
        const uniqueRecs = Object.values(recObj);
        if (uniqueRecs.length > 0) {
            report += `\n–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:`;
            uniqueRecs.forEach((rec, index) => {
                let penaltyText = rec.penalty && rec.penalty.trim() ? rec.penalty : '–¥–æ 300 000 —Ä—É–±. (—Å—Ç. 13.11 –ö–æ–ê–ü –†–§)';
                report += `\n${index + 1}. ${rec.title}\n   ${rec.recommendation}\n   –ü—Ä–∞–≤–æ–≤–æ–µ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ: ${rec.lawRef}\n   –í–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è: ${penaltyText}\n`;
            });
        }
        report += `\n\n–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ù–ê 2025 –ì–û–î:\n- –° 01.07.2025: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞–∂–¥–∞–Ω –†–§ (—à—Ç—Ä–∞—Ñ –¥–æ 18 –º–ª–Ω —Ä—É–±.)\n- –° 30.05.2025: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä–∞ –æ–± –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞—Ö –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤\n\n–î–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç –Ω–æ—Å–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç —é—Ä–∏–¥–∏—á–µ—Å–∫—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º –ø–æ –∑–∞—â–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –ø—Ä–∞–≤–æ–≤–æ–π –æ—Ü–µ–Ω–∫–∏ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.\n\n–û—Ç—á—ë—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è 152-–§–ó.`;
        return report;
    }
    </script>
</body>
</html>
